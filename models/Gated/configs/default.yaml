project:
  name: gated-blip2
  seed: 1337
  output_dir: /home/linux/artcap-blip2-4/models/Gated/logs

data:
  dataset_root: /data
  dataset_name: artquest
  train_split: train
  val_split: val
  test_split: test
  image_root: /data/artquest/images
  num_workers: 8
  batch_size: 16
  image_size: 384
  caption_key: question
  answer_key: answer
  style_key: style
  question_id_key: question_id
  image_key: image

model:
  visual_encoder: eva_clip_g
  freeze_visual_encoder: true
  opt_model: facebook/opt-2.7b
  efficientnet_output_dim: 768
  convert_from_blip_norm: true
  qformer:
    num_query_tokens: 32
  gating:
    type: film
    per_head: true
    hidden_dim: 512
    init_scale: 0.01
    use_layer_norm: true
  prompt_mapper:
    num_tokens: 4
    hidden_dim: 1024
    dropout: 0.1
    use_layer_norm: true
  lora:
    enabled: false
    rank: 8
    alpha: 16
    dropout: 0.0

training:
  max_epochs: 5
  gradient_accumulation: 1
  lr: 1.0e-4
  lr_scheduler: cosine
  warmup_steps: 1000
  weight_decay: 0.01
  logging_steps: 50
  save_best_only: true
  checkpoint_path: /home/linux/artcap-blip2-4/models/Gated/checkpoints/best.pt
  use_amp: true
  max_grad_norm: 1.0

loss:
  main_weight: 1.0
  style_hit_weight: 0.05
  consistency_kl_weight: 0.02

evaluation:
  metrics: [bleu, cider, rougeL]

paths:
  efficientnet_checkpoint: /home/linux/artcap-blip2-4/runs/efficientnet-28/best.pt
  blip2_cache: /home/linux/artcap-blip2-4/models/blip2-opt-2.7b

